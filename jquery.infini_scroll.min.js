(function($){$.fn.infini_scroll=function(options){var opts=$.extend({},
    $.fn.infini_scroll.defaults,options);return this.each(function(){var $this=$(this);var p=1;var is_loading=false;var index=0;function load_data(){if(is_loading==false){opts.debug&&window.console&&console.info('ajax load');is_loading=true;p++;index++;if(opts.totalPages>0&&p>opts.totalPages){return}var params={};params[opts.varPage]=p;$.ajax({type:"get",url:opts.url,data:params,dataType:"html",timeout:5000,beforeSend:function(){$(opts.loadingElement).show()},success:function(html){$this.append(html);if(p>=opts.totalPages){$(opts.loadMoreElement).hide()}},complete:function(){is_loading=false;$(opts.loadingElement).hide()}})}}$(opts.loadMoreElement).click(function(){index=0;$(opts.loadMoreElement).hide();load_data()});$(window).scroll(function(){var scroll_top=$(this).scrollTop();var window_height=$(window).height();var document_height=$(document).height();opts.debug&&window.console&&index>0&&console.info('index :'+index);if(index>=opts.round){if(opts.totalPages>p){$(opts.loadMoreElement).show()}return}if(scroll_top+window_height+opts.triggerBottom>=document_height&&scroll_top>50){load_data()}})})}$.fn.infini_scroll.defaults={totalPages:0,url:'',varPage:'p',triggerBottom:100,round:3,loadingElement:'#J_loading',loadMoreElement:'#J_load_more',debug:false}})(jQuery);